{% extends "layout/nav_bar.html" %}
{% load static %}
{% block title %}Accueil - WorldCast{% endblock %}
{% block head %}
  <link rel="stylesheet" href="{% static 'css/index.css' %}">
  <script src="{% static 'js/meteo.js' %} "defer ></script>
{% endblock %}
{% block content %}

<div class="centent mt-3">
  
  <div class="mt-[30px] ">
     <div
    class="bg-[#409ac7] text-white rounded-2xl shadow-lg flex justify-between  w-[100%]  p-3 ">

    <!-- Bloc gauche (ville + m√©t√©o actuelle) -->
    <div class=" items-center space-x-4 px-6">
         <p class=" rounded  px-2 w-[100px]"> {{ jour }}</p>
          <!-- Ic√¥ne selon les pr√©cipitations -->
             {% for day in weather_data %}
  {% if forloop.first %}
    <!-- üëâ Ceci s‚Äôex√©cute uniquement pour le premier √©l√©ment -->
    <div class="">
     

      {% if day.Precipitation_mm > 10 %}
        <img src="{% static 'img/imgmeteo/rainy.png' %}" alt="Rain" class="w-10 h-10">
      {% elif day.Precipitation_mm > 0 %}
        <img src="{% static 'img/imgmeteo/cloudly.png' %}" alt="Cloudy" class="w-10 h-10">
      {% else %}
        <img src="{% static 'img/imgmeteo/sun.png' %}" alt="Sun" class="w-10 h-10">
      {% endif %}
       <p class="text-lg font-bold">{{ day.Precipitation_mm }} mm</p>
      <div class="flex space-between gap-6">
        <div class="gap-6">
          
          <h2 class="text-2xl font-semibold">{{ ville }}</h2> 

        </div>
        <h1 class="text-3xl font-bold mt-2">{{ day.Probabilite_Max }}%</h1>
      </div>
      
    </div>
  {% endif %}
{% endfor %}

     
    </div>

    <!-- Bloc droite (pr√©visions) -->
     <!-- Bloc droite (pr√©visions) -->
    <div id="weather-scroll" class="overflow-hidden w-[500px] relative">
      <div id="weather-cards" class="flex space-x-4 absolute">
        {% if weather_data %}
          {% for day in weather_data %}
            <div class="bg-white text-gray-800 rounded-xl p-4 min-w-[150px] flex flex-col items-center shadow">
              <!-- Afficher les pr√©cipitations -->
              <p class="text-lg font-bold">{{ day.Precipitation_mm }} mm</p>
          
              <!-- Ic√¥ne selon les pr√©cipitations -->
              {% if day.Precipitation_mm > 10 %}
                <img src="{% static 'img/imgmeteo/rainy.png' %}" alt="Rain" class="w-10 h-10">
              {% elif day.Precipitation_mm > 0 %}
                <img src="{% static 'img/imgmeteo/cloudly.png' %}" alt="Cloudy" class="w-10 h-10">
              {% else %}
                <img src="{% static 'img/imgmeteo/sun.png' %}" alt="Sun" class="w-10 h-10">
              {% endif %}
          
                 <!-- Date format√©e -->
              <p class="text-sm font-semibold mt-2">{{ day.Date|date:"l" }}</p>
              <p class="text-xs text-gray-500">{{ day.Date|date:"d/m" }}</p>
          
               <!-- Probabilit√© de pluie (CORRIG√â) -->
              <p class="text-xs text-blue-600 mt-1">{{ day.Probabilite_Max }}%</p>
            </div>
         {% endfor %}
        {% else %}
        <p class="text-white">Aucune donn√©e m√©t√©o disponible</p>
        {% endif %}
     </div>
    </div>

  </div>
    <div class="mt-[30px]">
     <p class=" text-lg  font-bold pb-2">{{ message }}</p>
    <div class="carte p-5">
      {{ carte|safe }}
    </div>
  </div> 
<!-- CONTENEUR DASHBOARD EN DESSOUS -->


<!-- Ajouter Chart.js depuis CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('weatherChart').getContext('2d');
  const weatherChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'],
      datasets: [
        {
          label: 'Temp√©rature (¬∞C)',
          data: [28, 27, 29, 30, 28, 26, 27],
          borderColor: 'rgb(239, 68, 68)',
          backgroundColor: 'rgba(239, 68, 68, 0.2)',
          tension: 0.4
        },
        {
          label: 'Humidit√© (%)',
          data: [65, 60, 70, 75, 68, 62, 64],
          borderColor: 'rgb(59, 130, 246)',
          backgroundColor: 'rgba(59, 130, 246, 0.2)',
          tension: 0.4
        },
        {
          label: 'Vent (km/h)',
          data: [12, 10, 14, 13, 12, 11, 10],
          borderColor: 'rgb(34, 197, 94)',
          backgroundColor: 'rgba(34, 197, 94, 0.2)',
          tension: 0.4
        },
        {
          label: 'Pr√©cipitations (mm)',
          data: [5, 0, 10, 0, 2, 0, 1],
          borderColor: 'rgb(79, 70, 229)',
          backgroundColor: 'rgba(79, 70, 229, 0.2)',
          tension: 0.4
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: {
          display: true,
          text: '√âvolution m√©t√©o sur une semaine'
        }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

  <style>
#weather-scroll {
  cursor: grab; /* Indique que c‚Äôest draggable */
}
#weather-cards {
  white-space: nowrap;
  will-change: transform;
}
#weather-cards.dragging {
  cursor: grabbing;
}
</style>

  {% endblock %}